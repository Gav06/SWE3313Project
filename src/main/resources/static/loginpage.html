<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Piero's Pizzeria - Login</title>
    <script>
        async function handleLogin(event) {
          event.preventDefault();
          const username = document.getElementById('username').value;
          const password = document.getElementById('password').value;

          if (!username || !password) {
            showError("Enter Username/Password");
            return;
          }

          try {
            const response = await fetch('/api/login', {
              method: 'POST',
              headers: { 'Content-Type': 'application/json' },
                // fill request with user credentials (remember to change this to a hashed version in the future)
              body: JSON.stringify({ username, password })
            });

            const result = await response.json();
            if (result.success) {
              window.location.href = 'menu/pizza.html';
            } else {
              showError("Incorrect Username/Password. Try Again!");
            }
          } catch (error) {
            showError("LOGIN UNAVAILABLE. TRY AGAIN IN 1 MINUTE");
            console.error(error);
          }
        }

        function showError(message) {
          const errorDiv = document.getElementById('error');
          errorDiv.textContent = message;
          errorDiv.style.display = 'block';
        }
    </script>
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
    <body>
        <header>
            <div class="titleDiv">
                <!--Is this supposed to be piero's or "mom and pop's" i still cant remember?-->
                <h1>Login to Piero's Pizzeria</h1>
            </div>
        </header>
        <main>
            <form onsubmit="handleLogin(event)">
                <p>Donâ€™t Have an Account? <a href="signup.html">Sign Up</a></p>

                <label for="username">Username:</label><br>
                <input type="text" id="username" name="username"><br><br>

                <label for="password">Password:</label><br>
                <input type="password" id="password" name="password"><br><br>

                <button type="submit">LOGIN</button>
                <button type="button" onclick="window.location.href='index.html'">BACK</button>

                <div id="error" style="color: red; margin-top: 1em; display: none;"></div>
            </form>
        </main>
    </body>
</html>